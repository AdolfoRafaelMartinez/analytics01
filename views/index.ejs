<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/styles.css" />
</head>
<body>
    <h1>Hello world</h1>
    <p id="mnemonic-p"><%= mnemonic %></p>
    <button id="generate-btn">Generate New Mnemonic</button>
    <button id="wallet-btn">Generate Wallet</button>
    <button id="save-btn">Save Mnemonic</button>
    <div id="wallet-info"></div>

    <script>
        document.getElementById('generate-btn').addEventListener('click', async () => {
            const response = await fetch('/api');
            const data = await response.json();
            document.getElementById('mnemonic-p').textContent = data.mnemonic;
        });

        document.getElementById('wallet-btn').addEventListener('click', async () => {
            const mnemonic = document.getElementById('mnemonic-p').textContent;
            const response = await fetch('/api/wallet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ mnemonic: mnemonic }),
            });
            const wallet = await response.json();
            if (wallet.error) {
                document.getElementById('wallet-info').innerHTML = `<p>Error: ${wallet.error}</p>`;
            } else {
                let html = `<h2>Wallet Information</h2>`;
                html += `<p><strong>Mnemonic:</strong> ${wallet.mnemonic}</p>`;
                html += `<p><strong>Seed:</strong> ${wallet.seed}</p>`;
                html += `<p><strong>Network:</strong> ${wallet.network}</p>`;
                html += `<p><strong>Root:</strong> ${wallet.root}</p>`;
                html += `<h3>Child Keys:</h3>`;
                html += `<table>`;
                html += `<tr><th>Path</th><th>Address</th><th>Private Key</th><th>Public Key</th></tr>`;
                wallet.childKeys.forEach(key => {
                    html += `<tr>`;
                    html += `<td>${key.path}</td>`;
                    html += `<td>${key.address}</td>`;
                    html += `<td>${key.privateKey}</td>`;
                    html += `<td>${key.publicKey}</td>`;
                    html += `</tr>`;
                });
                html += `</table>`;
                document.getElementById('wallet-info').innerHTML = html;
            }
        });

        document.getElementById('save-btn').addEventListener('click', () => {
            const mnemonic = document.getElementById('mnemonic-p').textContent;
            const blob = new Blob([mnemonic], { type: 'text/plain' });
            const anchor = document.createElement('a');
            anchor.download = 'mnemonic.txt';
            anchor.href = window.URL.createObjectURL(blob);
            anchor.click();
            window.URL.revokeObjectURL(anchor.href);
        });
    </script>
</body>
</html>