<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/styles.css" />
</head>
<body>
    <h1>Hello world</h1>
    <p id="mnemonic-p"><%= mnemonic %></p>
    <button id="generate-btn">Generate New Mnemonic</button>
    <button id="wallet-btn">Generate Wallet</button>
    <button id="save-btn">Save Mnemonic</button>
    <hr>
    <input type="file" id="load-input" accept=".txt">
    <button id="load-btn">Load Mnemonic & Generate Wallet</button>
    <div id="wallet-info"></div>

    <script>
        document.getElementById('generate-btn').addEventListener('click', async () => {
            const response = await fetch('/api');
            const data = await response.json();
            document.getElementById('mnemonic-p').textContent = data.mnemonic;
            document.getElementById('wallet-info').innerHTML = ''; // Clear previous wallet info
        });

        document.getElementById('wallet-btn').addEventListener('click', async () => {
            const mnemonic = document.getElementById('mnemonic-p').textContent;
            await generateWallet(mnemonic);
        });

        document.getElementById('save-btn').addEventListener('click', () => {
            const mnemonic = document.getElementById('mnemonic-p').textContent;
            const blob = new Blob([mnemonic], { type: 'text/plain' });
            const anchor = document.createElement('a');
            anchor.download = 'mnemonic.txt';
            anchor.href = window.URL.createObjectURL(blob);
            anchor.click();
            window.URL.revokeObjectURL(anchor.href);
        });

        document.getElementById('load-btn').addEventListener('click', () => {
            const input = document.getElementById('load-input');
            if (input.files.length === 0) {
                alert("Please select a mnemonic file!");
                return;
            }
            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = async (event) => {
                const mnemonic = event.target.result.trim();
                document.getElementById('mnemonic-p').textContent = mnemonic;
                await generateWallet(mnemonic);
            };

            reader.onerror = (event) => {
                alert("Error reading file: " + event.target.error.name);
            };

            reader.readAsText(file);
        });

        async function generateWallet(mnemonic) {
            const response = await fetch('/api/wallet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ mnemonic: mnemonic }),
            });
            const wallet = await response.json();
            const walletInfoDiv = document.getElementById('wallet-info');
            if (wallet.error) {
                walletInfoDiv.innerHTML = `<p>Error: ${wallet.error}</p>`;
            } else {
                let html = `<h2>Wallet Information</h2>`;
                html += `<p><strong>Mnemonic:</strong> ${wallet.mnemonic}</p>`;
                html += `<p><strong>Seed:</strong> ${wallet.seed}</p>`;
                html += `<p><strong>Network:</strong> ${wallet.network}</p>`;
                html += `<p><strong>Root:</strong> ${wallet.root}</p>`;
                html += `<h3>Child Keys:</h3>`;
                html += `<table>`;
                html += `<tr><th>Path</th><th>Address</th><th>Private Key</th><th>Public Key</th></tr>`;
                wallet.childKeys.forEach(key => {
                    html += `<tr>`;
                    html += `<td>${key.path}</td>`;
                    html += `<td>${key.address}</td>`;
                    html += `<td>${key.privateKey}</td>`;
                    html += `<td>${key.publicKey}</td>`;
                    html += `</tr>`;
                });
                html += `</table>`;
                walletInfoDiv.innerHTML = html;
            }
        }
    </script>
</body>
</html>